{% extends "IntractoSecretSantaBundle::base.html.twig" %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="{{ asset('build/js/report.js') }}"></script>
{% endblock %}

{% block main %}
    <div class="box">
        <h1>Report</h1>
        <div class="select-secret-santa">
            <select name="year" id="select-season" title="Select a year">
                <option value="all">All time</option>
                {% for year in years %}
                    <option value="{{ year }}">{{ year }} - {{ year+1 }} </option>
                {% endfor %}
            </select>
        </div>
        <small>Choose the season you want to get the data from. Each season begins the 1st of April and lasts until March 31.</small>

        {% if current_year != 'all' %}
            <div class="col-xs-12 col-md-6 report">
        {% else %}
            <div class="col-xs-12 report">
        {% endif %}
        <div class="report_inside">
        {% if current_year != 'all' %}
            <h3>Season {{ current_year }}-{{ current_year + 1 }}</h3>
        {% else %}
            <h3>All time results</h3>
        {% endif %}

                    <table>
                        <col width="50%">
                        <col width="25%">
                        <col width="25%">
                        <tr>
                            <td>Confirmed parties:</td>
                            <td>{{ parties[0]['partyCount'] }}</td>
                            {% if difference_party_data is defined and difference_party_data is not empty %}
                                {% if difference_party_data['party_count_difference'] > 0 %}
                                    <td class="positive">+ {{ difference_party_data['party_count_difference'] }}</td>
                                {% elseif difference_party_data['party_count_difference'] == 0 %}
                                    <td>0</td>
                                {% else %}
                                    <td class="negative">{{ difference_party_data['party_count_difference'] }}</td>
                                {% endif %}
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Total participants invited:</td>
                            <td>{{ participants }}</td>
                            {% if difference_party_data is defined and difference_party_data is not empty %}
                                {% if difference_party_data['participant_count_difference'] > 0 %}
                                    <td class="positive">+ {{ difference_party_data['participant_count_difference'] }}</td>
                                {% elseif difference_party_data['participant_count_difference'] == 0 %}
                                    <td>0</td>
                                {% else %}
                                    <td class="negative">{{ difference_party_data['participant_count_difference'] }}</td>
                                {% endif %}
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Confirmed participants:</td>
                            <td>{{ confirmed_participants[0]['confirmedParticipantCount'] }}</td>
                            {% if difference_party_data is defined and difference_party_data is not empty %}
                                {% if difference_party_data['confirmed_participant_count_difference'] > 0 %}
                                    <td class="positive">+ {{ difference_party_data['confirmed_participant_count_difference'] }}</td>
                                {% elseif difference_party_data['confirmed_participant_count_difference'] == 0 %}
                                    <td>0</td>
                                {% else %}
                                    <td class="negative">{{ difference_party_data['confirmed_participant_count_difference'] }}</td>
                                {% endif %}
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Average amount of participants per party:</td>
                            <td>{{ participant_average|round }}</td>
                            {% if difference_party_data is defined and difference_party_data is not empty %}
                                {% if difference_party_data['average_participants_difference']|round > 0 %}
                                    <td class="positive">+ {{ difference_party_data['average_participants_difference']|round }}</td>
                                {% elseif difference_party_data['average_participants_difference']|round == 0 %}
                                    <td>0</td>
                                {% else %}
                                    <td class="negative">{{ difference_party_data['average_participants_difference']|round }}</td>
                                {% endif %}
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Unique participants:</td>
                            <td>{{ distinct_participants[0]['distinctParticipantCount'] }}</td>
                            {% if difference_party_data is defined and difference_party_data is not empty %}
                                {% if difference_party_data['distinct_participant_count_difference'] > 0 %}
                                    <td class="positive">+ {{ difference_party_data['distinct_participant_count_difference'] }}</td>
                                {% elseif difference_party_data['distinct_participant_count_difference'] == 0 %}
                                    <td>0</td>
                                {% else %}
                                    <td class="negative">{{ difference_party_data['distinct_participant_count_difference'] }}</td>
                                {% endif %}
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Amount of completed wishlists:</td>
                            <td>{{ wishlist_average|number_format(2, '.', '') }} %</td>
                            {% if difference_party_data is defined and difference_party_data is not empty %}
                                {% if difference_party_data['average_wishlist_difference']|number_format(2, '.', '') > 0 %}
                                    <td class="positive">+ {{ difference_party_data['average_wishlist_difference']|number_format(2, '.', '') }} %</td>
                                {% elseif difference_party_data['average_wishlist_difference']|number_format(2, '.', '') == 0 %}
                                    <td>0.00%</td>
                                {% else %}
                                    <td class="negative">{{ difference_party_data['average_wishlist_difference']|number_format(2, '.', '') }} %</td>
                                {% endif %}
                            {% endif %}
                        </tr>
                    </table>
                </div>
            </div>
            {% if current_year == 'all' %}
                <div class="clearfix"></div>
            {% endif %}
            {% if current_year != 'all' %}
            <div class="col-xs-12 col-md-6 report">
                <div class="report_inside">
                    <h3>Total (this season included)</h3>
                    <table>
                        <col width="50%">
                        <col width="50%">
                        <tr>
                            <td>Confirmed parties:</td>
                            <td>{{ total_parties[0]['partyCount'] }}</td>
                        </tr>
                        <tr>
                            <td>Total participants invited:</td>
                            <td>{{ total_participants[0]['totalParticipantCount'] }}</td>
                        </tr>
                        <tr>
                            <td>Confirmed participants:</td>
                            <td>{{ total_confirmed_participants[0]['confirmedParticipantCount'] }}</td>
                        </tr>
                        <tr>
                            <td>Average amount of participants per party:</td>
                            <td>{{ total_participant_average|round }}</td>
                        </tr>
                        <tr>
                            <td>Unique participants:</td>
                            <td>{{ total_distinct_participants[0]['distinctParticipantCount'] }}</td>
                        </tr>
                        <tr>
                            <td>Amount of completed wishlists:</td>
                            <td>{{ total_wishlist_average|number_format(2, '.', '') }} %</td>
                        </tr>
                    </table>
                </div>
            </div>
            {% endif %}

        <div class="col-xs-12 col-md-6 report">
            <div class="report_inside">
                <h3>Confirmed parties per month</h3>

                <div id="party_chart" style="width: 100%"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 report">
            <div class="report_inside">
                <h3>Total amount of confirmed parties (this season included)</h3>

                <div id="total_party_chart" style="width: 100%"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 report">
            <div class="report_inside">
                <h3>Confirmed participants per month</h3>

                <div id="participant_chart" style="width: 100%"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 report">
            <div class="report_inside">
                <h3>Total amount of confirmed participants (this season included)</h3>

                <div id="total_participant_chart" style="width: 100%"></div>
            </div>
        </div>

        <div class="clearfix"></div>

        {#{% if party_data is empty %}#}
        {#<div>#}
        {#<p>There are no data available for this season.</p>#}
        {#</div>#}
        {#{% else %}#}
        {#{% include 'IntractoSecretSantaBundle:ReportOld:result.html.twig' %}#}
        {#{% include 'IntractoSecretSantaBundle:ReportOld:analytics.html.twig' %}#}

        {#<div class="clearfix"></div>#}
        {#{% endif %}#}
    </div>
{% endblock main %}
